
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>3D Maze Runner</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body{margin:0;overflow:hidden;background:#0b0f1a;color:#fff;font-family:Arial}
#hud{position:absolute;top:12px;left:50%;transform:translateX(-50%);z-index:10;text-align: center;
background:rgba(0,0,0,.6);padding:20px;border-radius:8px}
#startbx{position:absolute; left:50%; top:48%; transform:translate(-50%,-50%); z-index:80;text-align: center; background:rgba(0,0,0,0.7); padding:18px; border-radius:10px;display: block;}
#centerMsg{position:absolute; left:50%; top:48%; transform:translate(-50%,-50%); z-index:80;text-align: center; background:rgba(0,0,0,0.7); padding:18px; border-radius:10px; display:none;}
button{padding:8px 12px; border-radius:6px; cursor:pointer;}
#instructions {position:absolute;top:12px;left:12px;z-index:10;
background:rgba(0,0,0,.6);padding:20px;border-radius:8px;font-size: 15px;color: #bdbdbd;}
</style>
</head>
<body>

<div id="startbx"><p>Start the Game</p><div style="text-align:center; margin-top:10px;"><button id="startBtn">Start</button></div></div>

<div id="hud">
  <p>3D Maze Runner Game</p>
  <div id="timer">Time: 0</div>
  <div id="score">Coins: 0</div>
  <div id="status">Status: Playing</div>
</div>


<div id="instructions">
Controls: A/D (left/right) &nbsp; W (forward) &nbsp; S (back) &nbsp;  <br/>Sprinting: Left/Right Shift <br/>
Hold left mouse button + move to rotate camera
</div>

<div id="centerMsg"><div id="centerText"></div><div style="text-align:center; margin-top:10px;"><button id="restartBtn">Restart</button></div></div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

let gameStarted = false;
const WALK_SPEED = 4;
const SPRINT_SPEED = 7;

///////////////////////
//HUD refs
///////////////////////
const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');
const statusEl = document.getElementById('status');
const restartBtn = document.getElementById('restartBtn');
const startBtn = document.getElementById('startBtn');
const startbx = document.getElementById('startbx');
const centerMsg = document.getElementById('centerMsg');
const centerText = document.getElementById('centerText');

//////////////////////
// SCENE SETUP
//////////////////////
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b0f1a);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

///////////////////////
// Sound
///////////////////////
const listener = new THREE.AudioListener();
camera.add(listener);
const audioLoader = new THREE.AudioLoader();

const coinSound = new THREE.Audio(listener);
const allcoinSound = new THREE.Audio(listener);
const winSound = new THREE.Audio(listener);
const restartSound = new THREE.Audio(listener);
const gameSound = new THREE.Audio(listener);
const impactSound = new THREE.Audio(listener);

audioLoader.load('sounds/game.wav', buffer => {
  gameSound.setBuffer(buffer);
  gameSound.setLoop(false);
  gameSound.setVolume(0.3);
  
});

audioLoader.load('sounds/coin.wav', buffer => {
  coinSound.setBuffer(buffer);
  coinSound.setVolume(0.6);
});

audioLoader.load('sounds/allcoins.wav', buffer => {
  allcoinSound.setBuffer(buffer);
  allcoinSound.setVolume(0.6);
});

audioLoader.load('sounds/impact.wav', buffer => {
  impactSound.setBuffer(buffer);
  impactSound.setVolume(0.6);
});

audioLoader.load('sounds/win.wav', buffer => {
  winSound.setBuffer(buffer);
  winSound.setVolume(0.7);
});

audioLoader.load('sounds/restart.wav', buffer => {
  restartSound.setBuffer(buffer);
  restartSound.setVolume(0.5);
});

startBtn.addEventListener('click', () => {
  startbx.style.display = 'none';
  gameStarted = true;
  if (!gameSound.isPlaying) {
    gameSound.play();
    statusEl.innerText = "Status: Playing";
  }
}, { once: true }); 




//////////////////////
// LIGHTING
//////////////////////
scene.add(new THREE.AmbientLight(0xffffff,0.4));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(5,10,5);
scene.add(dirLight);

//////////////////////
// FLOOR
//////////////////////
const floorTex = new THREE.TextureLoader().load('https://threejs.org/examples/textures/terrain/grasslight-big.jpg');
floorTex.wrapS = floorTex.wrapT = THREE.RepeatWrapping;
floorTex.repeat.set(10, 10);
const floorMat = new THREE.MeshStandardMaterial({ map: floorTex, roughness: 1 });
const floor = new THREE.Mesh(new THREE.PlaneGeometry(200,200), floorMat);
floor.rotation.x = -Math.PI/2;
floor.position.y = -0.5;
scene.add(floor);

//////////////////////
// PLAYER
//////////////////////
const PLAYER_START = new THREE.Vector3(2, 0.9, 2);
const player = new THREE.Mesh(
  new THREE.BoxGeometry(1,1.8,1),
  new THREE.MeshStandardMaterial({color:0x77aaff})
);
player.position.set(2,0.9,2);
scene.add(player);

//////////////////////
// EXIT
//////////////////////
const exitMat = new THREE.MeshStandardMaterial({
  color: 0x004422,
  emissive: 0x00ff88,
  emissiveIntensity: 0.6,
  metalness: 0.2,
  roughness: 0.3
});

const exit = new THREE.Mesh(
  new THREE.BoxGeometry(1.5, 1.5, 1.5),
  exitMat
);

exit.position.set(13, 0.9, 2);

const exitLight = new THREE.PointLight(0x00ff88, 1.2, 6);
exitLight.position.copy(exit.position);
scene.add(exitLight);

scene.add(exit);


//////////////////////
// INPUT
//////////////////////
const keys = {};

window.addEventListener('keydown', (e) => {
  if (!gameStarted) return;
  
  keys[e.code] = true;
  keys[e.key.toLowerCase()] = true;
});

window.addEventListener('keyup', (e) => {
  if (!gameStarted) return;

  keys[e.code] = false;
  keys[e.key.toLowerCase()] = false;
});



//////////////////////
// MOUSE LOOK
//////////////////////
let yaw = Math.PI, pitch = 0.25;
let dragging=false, lx=0, ly=0;

renderer.domElement.addEventListener('mousedown',e=>{
  dragging=true; lx=e.clientX; ly=e.clientY;
});
window.addEventListener('mouseup',()=>dragging=false);
window.addEventListener('mousemove',e=>{
  if(!dragging) return;
  yaw -= (e.clientX-lx)*0.005;
  pitch -= (e.clientY-ly)*0.004;
  pitch=Math.max(-0.8,Math.min(1.2,pitch));
  lx=e.clientX; ly=e.clientY;
});

//////////////////////
// MAZE WALLS
//////////////////////
const walls=[];
const layout=[
[1,1,1,1,1,1,1,1],
[1,0,0,0,1,0,0,1],
[1,0,1,0,1,0,1,1],
[1,0,1,0,0,0,0,1],
[1,0,1,1,1,1,0,1],
[1,0,0,0,0,0,0,1],
[1,1,1,1,1,1,1,1]
];
const wallTex = new THREE.TextureLoader().load('https://threejs.org/examples/textures/brick_diffuse.jpg');


layout.forEach((r,z)=>r.forEach((c,x)=>{
  if(c){
    wallTex.wrapS = wallTex.wrapT = THREE.RepeatWrapping;
    wallTex.repeat.set(1,0.5);
    const w=new THREE.Mesh(
      new THREE.BoxGeometry(2,2,2),
      new THREE.MeshStandardMaterial({ map: wallTex })
    );
    w.position.set(x*2,1,z*2);
    scene.add(w);
    walls.push(w);
  }
}));

//////////////////////
// COINS
//////////////////////
let coins=[];
const coinGeo=new THREE.CylinderGeometry(0.4,0.4,0.2,24);
const coinMat=new THREE.MeshStandardMaterial({color:0xffd700});
const coinPositions = [
  {x:4,z:2},{x:10,z:2},{x:6,z:6},{x:10,z:6},{x:12,z:10},{x:6,z:10},{x:2,z:10}
];

function createCoins() {
  coins.forEach(c => scene.remove(c));
  coins = [];

  coinPositions.forEach(p=>{
    const c = new THREE.Mesh(coinGeo, coinMat);
    c.rotation.x = Math.PI/2;
    c.position.set(p.x, 0.6, p.z);
    scene.add(c);
    coins.push(c);
  });
}

createCoins();

let coinsnumber=coins.length;
//////////////////////
// COLLISION
//////////////////////
const box=(o)=>new THREE.Box3().setFromObject(o);
const hit=(a,b)=>a.intersectsBox(b);

//////////////////////
//checkcollision
/////////////////////
function checkCollision(a, b) {
  const boxA = new THREE.Box3().setFromObject(a);
  const boxB = new THREE.Box3().setFromObject(b);
  return boxA.intersectsBox(boxB);
}

//////////////////////
// GAME LOOP
//////////////////////
let clock=new THREE.Clock(), time=0, score=0;
let start = performance.now();
let gameWon = false;


function animate(){
  requestAnimationFrame(animate);
  const dt=clock.getDelta();

  if(gameStarted){
    if (!gameWon) {
    time += dt;
    } 
  }


  const glow = 0.5 + Math.sin(time * 3) * 0.3;
  exit.material.emissiveIntensity = glow;
  exitLight.intensity = 1 + glow;



  const fwd=new THREE.Vector3(-Math.sin(yaw),0,-Math.cos(yaw));
  const right=new THREE.Vector3(Math.cos(yaw),0,-Math.sin(yaw));
  const prev=player.position.clone();
  const speed = (keys['ShiftLeft'] || keys['ShiftRight']) ? SPRINT_SPEED : WALK_SPEED;

  if (!gameWon) {
    if (keys['KeyW'] || keys['w'] || keys['ArrowUp'])
      player.position.add(fwd.clone().multiplyScalar(speed * dt));

    if (keys['KeyS'] || keys['s'] || keys['ArrowDown'])
      player.position.add(fwd.clone().multiplyScalar(-speed * dt));

    if (keys['KeyD'] || keys['d'] || keys['ArrowRight'])
      player.position.add(right.clone().multiplyScalar(speed * dt));

    if (keys['KeyA'] || keys['a'] || keys['ArrowLeft'])
      player.position.add(right.clone().multiplyScalar(-speed * dt));
  }
  statusEl.innerText = (keys['ShiftLeft'] || keys['ShiftRight'])? "Status: Sprinting": "Status: Playing";

  const pBox=box(player);
  walls.forEach(w=>{
    if(hit(pBox,box(w))){
      player.position.copy(prev);
      if (impactSound.isPlaying) impactSound.stop();
      impactSound.play();
    }
    
  });

  coins.forEach((c,i)=>{
    c.rotation.z+=0.05;
    if(player.position.distanceTo(c.position)<1){
      scene.remove(c);
      coins.splice(i,1);
      score++;
      if (coinSound.isPlaying) coinSound.stop();
      coinSound.play();
      scoreEl.innerText="Coins: "+score;
      if(coins.length===0){
        if (coinSound.isPlaying) coinSound.stop();
        allcoinSound.play();
        statusEl.innerText="Status: YOU COLLECTED ALL COINS!";
      }
    }
  });
  ///////////////////////
  // CAMERA
  ////////////////////////
  const camOffset=new THREE.Vector3(0,7,8).applyAxisAngle(new THREE.Vector3(0,1,0),yaw);
  camera.position.copy(player.position).add(camOffset);
  camera.position.y+=Math.sin(pitch)*2;
  camera.lookAt(player.position.clone().add(new THREE.Vector3(0,1,0)));

  timerEl.innerText="Time: "+Math.floor(time);
  if (!gameWon && checkCollision(player, exit)) {
    gameWon = true;
    exitLight.intensity = 0;
    exit.material.emissiveIntensity = 0.2;

    if (winSound.isPlaying) winSound.stop();
    winSound.play();
    const total = Math.floor((performance.now()-start)/1000);
    timerEl.innerText="Time: "+total+"s";
    if(score==coinsnumber){
      centerText.innerText = `You escaped!\n YOU Collected All Coins! \n Time: ${total}s — Score: ${score} From ${coinsnumber}  \nPress Restart to play again.`;
    }else{
      centerText.innerText = `You escaped the Maze! \nTime: ${total}s — Score: ${score} From ${coinsnumber} \nPress Restart to play again.`;
    }
    centerMsg.style.display = 'block';
    statusEl.textContent = 'Status: Finished';
  }
  renderer.render(scene,camera);
}


restartBtn.addEventListener("click", () => {
  if (restartSound.isPlaying) restartSound.stop();
  restartSound.play();
  // reset timing
  start = performance.now();
  time = 0;

  // reset score and state
  score = 0;
  gameWon = false;

  // reset player
  player.position.copy(PLAYER_START);

  // reset UI
  centerMsg.style.display = 'none';
  timerEl.innerText = "Time: 0";
  scoreEl.innerText = "Coins: 0";
  statusEl.innerText = "Status: Playing";

  // reset coins
  createCoins();

  // reset exit
  exit.position.set(13, 0.9, 2);

});

animate();
</script>
</body>
</html>


